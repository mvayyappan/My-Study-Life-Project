<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Selection - My Study Life</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="../js/api.js"></script>
    <style>
        body { background: #f5f5f5; font-family: 'Inter', sans-serif; }
        .quiz-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 40px 20px; text-align: center;
        }
        .quiz-header h1 { margin: 0; font-size: 32px; }
        .quiz-header p { margin: 10px 0 0; opacity: 0.9; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .filter-section {
            background: white; padding: 30px; border-radius: 8px; margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .filter-group { margin-bottom: 20px; }
        .filter-group label { display: block; font-weight: 600; margin-bottom: 10px; color: #333; }
        
        .filter-buttons {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px;
        }
        
        .btn-filter {
            padding: 10px 15px; border: 2px solid #ddd; background: white; border-radius: 5px;
            cursor: pointer; transition: all 0.3s; font-weight: 600;
        }
        
        .btn-filter:hover { border-color: #667eea; color: #667eea; }
        .btn-filter.active { background: #667eea; color: white; border-color: #667eea; }
        
        .quiz-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px; margin-top: 30px;
        }
        
        .quiz-card {
            background: white; border-radius: 8px; padding: 25px; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s;
            border-left: 4px solid #667eea;
        }
        
        .quiz-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        .quiz-card h3 { margin: 0 0 10px; color: #667eea; font-size: 20px; }
        
        .quiz-meta {
            display: flex; justify-content: space-between; font-size: 14px; color: #666;
            margin: 15px 0; padding-bottom: 15px; border-bottom: 1px solid #eee;
        }
        
        .badge {
            display: inline-block; padding: 5px 10px; border-radius: 20px; font-size: 12px;
            font-weight: 600; margin-right: 5px;
        }
        
        .badge-easy { background: #e8f5e9; color: #2e7d32; }
        .badge-medium { background: #fff3e0; color: #e65100; }
        .badge-hard { background: #ffebee; color: #c62828; }
        
        .quiz-description { color: #666; font-size: 14px; margin: 15px 0; }
        
        .quiz-info {
            display: flex; justify-content: space-between; align-items: center;
            margin: 15px 0; font-size: 13px; color: #888;
        }
        
        .btn-start {
            width: 100%; padding: 12px; background: #667eea; color: white;
            border: none; border-radius: 5px; cursor: pointer; font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-start:hover { background: #764ba2; }
        
        .no-results {
            grid-column: 1 / -1; text-align: center; padding: 40px;
            color: #999; font-size: 18px;
        }
        
        .stats-summary {
            background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;
        }
        
        .stat-box {
            text-align: center; padding: 15px; background: #f9f9f9; border-radius: 5px;
        }
        
        .stat-box h4 { margin: 0 0 8px; color: #667eea; font-size: 20px; }
        .stat-box p { margin: 0; color: #666; font-size: 13px; }
        
        @media (max-width: 768px) {
            .filter-buttons { grid-template-columns: repeat(2, 1fr); }
            .quiz-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>

    <nav class="dash-nav">
        <a href="../index.html" class="logo">
            <i class="fa-solid fa-user-graduate"></i>
            <span>My Study Life</span>
        </a>
        <ul class="nav_links">
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="standard_materials.html">Materials</a></li>
            <li><a href="quiz.html">Quiz</a></li>
            <li><a href="my_notes.html">Notes</a></li>
            <li><a href="logout.html" class="logout-btn">Logout</a></li>
        </ul>
    </nav>

    <div class="quiz-header">
        <h1><i class="fa-solid fa-book"></i> Quiz Center</h1>
        <p>Select your grade and subject to practice</p>
    </div>

    <div class="container">
        <div class="stats-summary">
            <div class="stat-box">
                <h4>50</h4>
                <p>Total Quizzes</p>
            </div>
            <div class="stat-box">
                <h4>500+</h4>
                <p>Questions</p>
            </div>
            <div class="stat-box">
                <h4>3 Levels</h4>
                <p>Easy • Medium • Hard</p>
            </div>
            <div class="stat-box">
                <h4>5 Subjects</h4>
                <p>Tamil • English • Maths • Science • SS</p>
            </div>
        </div>

        <div class="filter-section">
            <div class="filter-group">
                <label><i class="fa-solid fa-graduation-cap"></i> Grade</label>
                <div class="filter-buttons" id="gradeFilters">
                    <button class="btn-filter active" onclick="filterQuizzes()">All</button>
                    <button class="btn-filter" onclick="filterQuizzes()">6</button>
                    <button class="btn-filter" onclick="filterQuizzes()">7</button>
                    <button class="btn-filter" onclick="filterQuizzes()">8</button>
                    <button class="btn-filter" onclick="filterQuizzes()">9</button>
                    <button class="btn-filter" onclick="filterQuizzes()">10</button>
                </div>
            </div>

            <div class="filter-group">
                <label><i class="fa-solid fa-book"></i> Subject</label>
                <div class="filter-buttons" id="subjectFilters">
                    <button class="btn-filter active" onclick="filterQuizzes()">All</button>
                    <button class="btn-filter" onclick="filterQuizzes()">Tamil</button>
                    <button class="btn-filter" onclick="filterQuizzes()">English</button>
                    <button class="btn-filter" onclick="filterQuizzes()">Maths</button>
                    <button class="btn-filter" onclick="filterQuizzes()">Science</button>
                    <button class="btn-filter" onclick="filterQuizzes()">SS</button>
                </div>
            </div>

            <div class="filter-group">
                <label><i class="fa-solid fa-chart-bar"></i> Difficulty Level</label>
                <div class="filter-buttons" id="difficultyFilters">
                    <button class="btn-filter active" onclick="filterQuizzes()">All</button>
                    <button class="btn-filter" onclick="filterQuizzes()">Easy</button>
                    <button class="btn-filter" onclick="filterQuizzes()">Medium</button>
                    <button class="btn-filter" onclick="filterQuizzes()">Hard</button>
                </div>
            </div>
        </div>

        <div id="quizGrid" class="quiz-grid"></div>
    </div>

    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms & Condition</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Contact</h3>
                <div class="contact-info">
                    <div><i class="fa-solid fa-location-dot"></i> Chennai</div>
                    <div><i class="fa-solid fa-phone"></i> +91 9360649867</div>
                    <div><i class="fa-solid fa-envelope"></i> help@mystudylife.com</div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let allQuizzes = [];
        let selectedGrade = null;
        let selectedSubject = null;
        let selectedDifficulty = null;

        // Initialize page
        async function initPage() {
            // Check if user is logged in
            if (!isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }

            // Load quizzes from API
            await loadQuizzesFromAPI();
            setupFilterButtons();
            renderQuizzes();
        }

        // Fetch quizzes from API
        async function loadQuizzesFromAPI() {
            try {
                const result = await getAllQuizzes();
                if (result.success) {
                    allQuizzes = result.data.map(quiz => ({
                        id: quiz.id,
                        grade: quiz.grade,
                        subject: quiz.subject,
                        difficulty: getDifficultyLevel(quiz.title),
                        title: quiz.title,
                        questions: quiz.total_questions,
                        description: quiz.description
                    }));
                    console.log('Loaded', allQuizzes.length, 'quizzes from API');
                } else {
                    console.error('Failed to load quizzes:', result.error);
                    allQuizzes = [];
                }
            } catch (error) {
                console.error('Error loading quizzes:', error);
                allQuizzes = [];
            }
        }

        // Extract difficulty from title
        function getDifficultyLevel(title) {
            if (title.includes('Easy')) return 'Easy';
            if (title.includes('Medium')) return 'Medium';
            if (title.includes('Hard')) return 'Hard';
            return 'Easy';
        }

        function getActiveBtnValue(containerId) {
            const container = document.getElementById(containerId);
            const buttons = container.querySelectorAll('.btn-filter');
            let activeValue = null;
            buttons.forEach(btn => {
                if (btn.classList.contains('active') && btn.textContent !== 'All') {
                    activeValue = btn.textContent;
                }
            });
            return activeValue;
        }

        function filterQuizzes() {
            selectedGrade = getActiveBtnValue('gradeFilters');
            selectedSubject = getActiveBtnValue('subjectFilters');
            selectedDifficulty = getActiveBtnValue('difficultyFilters');
            renderQuizzes();
        }

        function renderQuizzes() {
            let filtered = allQuizzes;

            if (selectedGrade) filtered = filtered.filter(q => q.grade == selectedGrade);
            if (selectedSubject) filtered = filtered.filter(q => q.subject === selectedSubject);
            if (selectedDifficulty) filtered = filtered.filter(q => q.difficulty === selectedDifficulty);

            const grid = document.getElementById('quizGrid');

            if (filtered.length === 0) {
                grid.innerHTML = '<div class="no-results">No quizzes found. Try different filters.</div>';
                return;
            }

            grid.innerHTML = filtered.map((quiz, idx) => `
                <div class="quiz-card">
                    <h3>${quiz.title}</h3>
                    <div class="quiz-meta">
                        <div>
                            <span class="badge badge-${quiz.difficulty.toLowerCase()}">${quiz.difficulty}</span>
                        </div>
                        <div>Grade ${quiz.grade}</div>
                    </div>
                    <div class="quiz-description">${quiz.subject} | ${quiz.questions} Questions</div>
                    <div class="quiz-info">
                        <span><i class="fa-solid fa-question"></i> ${quiz.questions} Questions</span>
                        <span><i class="fa-solid fa-timer"></i> 30 mins</span>
                    </div>
                    <button class="btn-start" onclick="startQuiz(${quiz.id}, '${quiz.title}')">
                        <i class="fa-solid fa-play"></i> Start Quiz
                    </button>
                </div>
            `).join('');
        }

        function setupFilterButtons() {
            document.querySelectorAll('.filter-buttons').forEach(container => {
                const buttons = container.querySelectorAll('.btn-filter');
                buttons.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        buttons.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        filterQuizzes();
                    });
                });
            });
        }

        function startQuiz(quizId, quizTitle) {
            // Store quiz ID and redirect to quiz page
            localStorage.setItem('currentQuizId', quizId);
            localStorage.setItem('currentQuizTitle', quizTitle);
            window.location.href = 'quiz.html?id=' + quizId;
        }

        // Initialize page on load
        document.addEventListener('DOMContentLoaded', initPage);
    </script>

</body>

</html>
